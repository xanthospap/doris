\subsubsection{Third Body Attraction}\label{sssec:third-body-perturbations}

The presence of other bodies in the gravitational ﬁeld exerted by a main central
body makes the problem of orbit determination a $N$-body problem, which however, as known, 
cannot be solved analytically. In case of artiﬁcial satellites orbiting the Earth 
at low altitudes, the gravitational force due to the Earth is by far stronger than 
those exerted by the Moon, Sun and/or planets. Therefore, the problem can be solved 
by using the methods of the perturbation theory.

If we introduce the vectors $\bm{r}$ and $\bm{s}$, to describe the geocentric 
coordinates of the satellite and the third-body respectively, then according to 
Newton's law, the acceleration of the satellite by the third-body, considered as 
a point mass, is (the subscript $pb$ denotes the \emph{perturbing body})
\begin{equation}
    \bm{\ddot{r}} = GM_{pb} \frac{\bm{s}-\bm{r}}
        {\norm{\bm{s}-\bm{r}}^3}
\end{equation}
where we have to also account for Earth's acceleration due to the perturbing body, 
hence
\begin{equation}\label{eq:mont337}
    \bm{\ddot{r}} = GM_{pb} \left( 
        \frac{\bm{s}-\bm{r}}{\norm{\bm{s}-\bm{r}}^3} 
        - \frac{\bm{s}}{\norm{\bm{s}}^3} \right)
\end{equation}

For the current Thesis, we only consider third body perurbations from Moon and Sun. 
In a similar fashion (using the software that has already been developed), third body 
attraction can be computed for all planets, though their effect can be safely neglected 
for \gls{leo} satellites, and applications of 

\paragraph{\gls{jpl} Ephemerides}\label{par:jpl-ephemerides}

To compute third body perturbation, as evident from \ref{eq:mont337}, we need to 
know the coordinates of the perturbing body at a given instant $t$. For high 
precision applications, Sun, Moon and planetary ephemerides are used and interpolated 
for the requested epoch.

\gls{jpl} Development Ephemeris (abbreved \texttt{JPL DE(number)}, or simply DE(number)) 
designates one of a series of mathematical models of the Solar System produced at the 
\href{https://www.jpl.nasa.gov/}{\gls{jpl}} for use in spacecraft navigation and astronomy. 
The models consist of numeric representations of positions, velocities and accelerations 
of major Solar System bodies, tabulated at equally spaced intervals of time, covering 
a specified span of years (\cite{wiki-jplde}). Further information and a description of 
vailable ephemerides, can be found at the 
\href{https://ssd.jpl.nasa.gov/planets/eph_export.html}{\gls{jpl} Planetary and Lunar Ephemerides} 
website.

For the purposes of this Thesis, we have developed software to interact with the 
\gls{jpl} DE files, generic enough to handle all versions of the ephemerides. 
We use an interface to the \gls{jpl}-provided Observation Geometry System
for Space Science Missions (\href{https://naif.jpl.nasa.gov/naif/}{SPICE}) 
software library \footnote{Based on the C version of the the 
\href{https://naif.jpl.nasa.gov/naif/toolkit_C.html}{Navigation and Ancillary Information Facilty (NAIF)}} 
to extract Sun, Moon and planet coordinates, and respective constants. Tests and 
validation are performed using the \texttt{DE421} ephemerides (\cite{Folkner2009}).

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{03directMoonTide}
  \caption{Third body acceleration from Moon on \gls{grace} for a one day arc in 
    \gls{icrf}. \gls{grace} orbit is extracted from the \texttt{COST-G} benchmark 
    test. Moon ephemerides extracted from \texttt{DE421}.}
  \label{fig:directMoonTideIcrf}
\end{figure}

\paragraph{Partial Derivatives of Third Body Perturbations}\label{par:third-body-perturbations-partials}

As can be shown from \ref{eq:mont337}, the partial derivative of the third body 
perurbation w.r.t to the satellite state vector $\bm{x}=\begin{pmatrix}\bm{r} & \bm{v} \end{pmatrix}^T$ is given by
\begin{equation}
  \begin{aligned}
    \frac{\partial \bm{\ddot{r}}}{\partial \bm{r}} &= 
      -GM_{pb} \left( \frac{1}{\norm{\bm{r}-\bm{s}}^3} \bm{I}_{3\times 3} 
      -3 \left(\bm{r}-\bm{s} \right) \frac{\left(\bm{r}-\bm{s} \right)^T}{\norm{\bm{r}-\bm{s}}^5}
      \right) \\
    \frac{\partial \bm{\ddot{r}}}{\partial \bm{v}} &= \bm{0}
  \end{aligned}
\end{equation}

\paragraph{Validation}\label{sssec:third-body-perurbation-validation}

To test our implementation, we checked our results against the \texttt{COST-G} 
benchmark test, considering third bidy perturbing accelerations from Moon and Sun. 
Input data for the test is a one day orbit arc of \gls{grace} in \gls{icrf} and 
the DE ephemerides file \texttt{DE421} (see \ref{par:jpl-ephemerides}). 
The differences are depicted in \ref{fig:directMoonTideIcrfVsCostg} and \ref{fig:directSunTideIcrfVsCostg} 
and information is tabulated in \ref{fig:directMoonTideIcrfVsCostg}.
\ref{fig:directMoonTideIcrfVsCostg} and \ref{fig:directSunTideIcrfVsCostg} reveal a 
harmonic behavior of the differences, but since the values are close to machine precision, 
no safe conclusion can be drawn.

\begin{table}[h!]
  \centering
  \begin{tabular}{ccccc}
      %\hline
      \textbf{Component} & \textbf{Min} & \textbf{Max} & \textbf{Mean} & \textbf{Std. Deviation}\\
      & \multicolumn{4}{c}{\si{\metre\per\square\second}} \\
      \hline
      $\ddot{x}_{Moon}$ & -1.72e-16 & +1.80e-16 & -1.02e-18 & 7.20e-17 \\ 
      $\ddot{y}_{Moon}$ & -2.25e-16 & +2.45e-16 & 4.14e-18  & 1.31e-16 \\
      $\ddot{z}_{Moon}$ & -1.27e-16 & +1.39e-16 & 2.32e-18  & 7.17e-17 \\
      $\ddot{x}_{Sun}$  & -5.34e-18 & +4.59e-18 & 3.95e-20  & 2.03e-18 \\
      $\ddot{x}_{Sun}$  & -9.95e-18 & +1.05e-17 & 2.39e-20  & 3.65e-18 \\
      $\ddot{x}_{Sun}$  & -4.21e-18 & +4.70e-18 & 8.50e-21  & 1.59e-18 \\
      \hline
  \end{tabular}
  \caption{Moon \& Sun direct tide acceleration differences against the \texttt{COST-G} benchmark test.}
  \label{table:directMoonTideIcrfVsCostg}
\end{table}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{03directMoonTideVsCostg}
  \caption{Third body acceleration induced by Moon on \gls{grace}; descripancies 
   against the \texttt{COST-G} benchmark test. Moon ephemerides extracted from \texttt{DE421}.
   Comparing results for a one day orbit arc of \gls{grace} in \gls{icrf}.}
  \label{fig:directMoonTideIcrfVsCostg}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{03directSunTideVsCostg}
  \caption{Third body acceleration induced by Sun on \gls{grace}; descripancies 
   against the \texttt{COST-G} benchmark test. Sun ephemerides extracted from \texttt{DE421}.
   Comparing results for a one day orbit arc of \gls{grace} in \gls{icrf}.}
  \label{fig:directSunTideIcrfVsCostg}
\end{figure}

