\subsubsection{Geopotential}\label{sssec:geopotential}

In the two-body problem (\autoref{ssec:two-body-problem}) a radially symmetric 
gravity force was assumed, acting like a point mass. For \gls{pod} however, this 
assumption needs to be replaced by a model closer to a real world scenario.
As known, the Earth is not a perfect sphere, but rather resembles an oblate spheroid, 
with different equatorial and polar diameter. To derive a more realistic model, 
it is convenient to use an equivalent representation involving the gradient of 
the corresponding gravity potential $U$ (\cite{Montenbruck2000}):
\begin{equation}
  \label{eq:geopotential}
  \ddot{\bm{r}} = \nabla U \textrm{ where } U = G M_{\Earth} \frac{1}{r}
\end{equation}
so that 
$\bm{F} = \begin{pmatrix} \frac{\partial U}{\partial x} & \frac{\partial U}{\partial y} & \frac{\partial U}{\partial z} \end{pmatrix}$
This formulation enables the replacement of the three components of the vector 
$\bm{F}$ by a single function $U$, thus simplifying notation and further 
developments. The geopotential is widely used in geodesy (see e.g. \cite{Moritz2005}).

Given an arbitrary mass distribution, the individual elementary mass contributions 
$dm = \rho (\bm{s}) d^3 s$ can be summed, and thus the potential be expressed as:
\begin{equation}\label{eq:mont34}
  U = G \int \frac{\rho (\bm{s})}{\norm{\bm{r}-\bm{s}}} \, d^3 s
\end{equation}
where $\bm{r}$ is the vector from the mass center to the attracted body (i.e. satellite) 
and $\bm{s}$ is the geocentric vector the elementary mass $dm$.

For any point $\bm{r}$ outside the mass, $r > s$, the inverse of the distance can 
be expanded using a series of \emph{Legendre polynomials}, as
\begin{equation}
  \frac{1}{\norm{\bm{r}-\bm{s}}} = \frac{1}{r} \sum_{n=0}^{\infty} 
    \left( \frac{s}{r} \right) ^n  P_n ( \cos \gamma )
\end{equation}
where $\cos \gamma = \frac{\bm{r} \cdot \bm{s}}{rs}$ (the angle between $\bm{r}$
and $\bm{s}$) and $P_n(u)$ is the Legendre polynomial of degree $n$. Making use of 
the addition theorem of Legendre polynomials (\cite{Montenbruck2000}):
\begin{equation}
  \label{eq:mont38}
  P_n (\cos \gamma ) = \sum_{m=0}^{n} \left( 2 - \delta _{0m} \right) 
    P_{nm} (\sin \phi ) P_{nm} (\sin{\phi ^\prime}) 
    \cos{m \left( \lambda - \lambda ^\prime \right) }
\end{equation}
with $P_{nm}$ the \emph{associated Legendre polynomials} of degree $n$ and order 
$m$ and $\begin{pmatrix} \phi & \lambda \end{pmatrix}$ and 
$\begin{pmatrix} \phi ^\prime & \lambda ^\prime \end{pmatrix}$ being the longitude 
and geocentric latitudes of points $\bm{r}$ and $\bm{s}$ respectively.

The Earth's gravity potential can now be written as:
\begin{equation}\label{eq:mont310}
  U (r, \phi, \lambda ) = \frac{G M_{\Earth}}{r} \sum_{n=0}^{\infty} \sum_{m=0}^{n} 
      \left( \frac{R_{\Earth}}{r} \right) ^n P_{nm} (\sin \phi )
      \left( C_{nm} \cos {m\lambda} + S_{nm} \sin{m\lambda} \right)
\end{equation}
with coefficients:
\begin{equation}
  \begin{aligned}
    C_{nm} = \frac{2 - \delta _{0m}}{M_{\Earth}} \frac{(n-m)!}{(n+m)!} 
      \int \left({\frac{s}{R_{\Earth}}}\right)^n P_{nm} (\sin \phi ^\prime) \cos {m\lambda ^\prime} \rho (\bm{s}) \, d^3 s \\
    S_{nm} = \frac{2 - \delta _{0m}}{M_{\Earth}} \frac{(n-m)!}{(n+m)!} 
      \int \left({\frac{s}{R_{\Earth}}}\right)^n P_{nm} (\sin \phi ^\prime) \sin {m\lambda ^\prime} \rho (\bm{s}) \, d^3 s
  \end{aligned}
\end{equation}
which describe the dependence on the Earth's internal mass distribution. In geodetic 
applications, the \emph{normalized} geopotential coefficients $\bar{C}_{nm}$ and 
${\bar{S}}_{nm}$, are most often used, and defined as
\begin{equation}
  \begin{Bmatrix} \bar{C}_{nm} \\ \bar{S}_{nm} \end{Bmatrix} = 
  \sqrt{\frac{(n+m)!}{\left(2-\delta _{0m}\right) \left(2n+1\right) \left(n-m\right)!}}
  \begin{Bmatrix} C_{nm} \\ S_{nm} \end{Bmatrix}
\end{equation}
which are much more uniform in magnitude, thus helping reduce round-off errors.
Note that the coefficients $C_{nm}$ and $S_{nm}$ are often called 
\emph{Stokes' coefficients}, e.g. \cite{Barthelmes2018}.

The acceleration due to the Earth's gravity potential can now be written as  
(\cite{Montenbruck2000})
\begin{equation}\label{eq:mont315}
  \bm{\ddot{r}} (r, \phi, \lambda ) = \nabla \frac{GM_{\Earth}}{r} \sum_{n=0}^{\infty} \sum_{m=0}^{n} 
    \left(\frac{R_{\Earth}}{r}\right) ^n \bar{P}_{nm} (\sin \phi )
    \left( \bar{C}_{nm} \cos{m\lambda} + \bar{S}_{nm} \sin{m\lambda} \right)
\end{equation}
where the \emph{normalized} associated Legendre functions are used
\begin{equation}
  \bar{P}_{nm} = \sqrt{\frac{\left(2-\delta _{0m}\right) \left(2n+1\right) \left(n-m\right)!}{(n+m)!}} P_{nm}
\end{equation}

\paragraph{Gravity Models}\label{par:gravity-models}

Earth gravity models, contain the potential coefficients $\bar{C}_{nm}$ and $\bar{S}_{nm}$ 
up to a given degree $n$ and order $m$ (with $m \le n$) and the parameters $GM_{\Earth}$ 
and $R_{\Earth}$ via which one can compute the geopotential or the induced acceleration 
on an orbiting satellite, given its position vector $\bm{r}$. Gravity models are derived from:
\begin{description}
  \item[Satellite data], making use of the fact that the Earth's gravity field 
    can produce perturbations ``seen'' in satellite orbits via \gls{pod}. It is worth 
    noting that since \gls{grace} (\cite{Tapley2004b}) was launched in March 2002, satellite 
    gravimetry has brought a new era of studying global mass variation and redistribution 
    through measuring the time-variable gravity field with unprecedented accuracy 
    (see e.g. \cite{Chen2022} and \cite{Jaggi2023}). This progress was further enhanced 
    with the launch of \gls{goce} (\cite{Johannessen2003}) in 2009.
  \item[Terrestrial observations] (surface gravimetry), providing precise local 
    and regional (short-wavelength) information on the gravity field. Due to their 
    inhomogeneous distribution though, deriving a global gravity model is quite challenging.
  \item[Altimeter data], which provide detailed information about the form of the 
    geoid, which may in turn be used to derive geopotential coefficients.
  \item[Combinations] of the above methods/data.
\end{description}

Recent advantages in gravity models and estimation, have enabled temporal modeling 
of the geopotential coefficients. Thus, the parameters $\bar{C}_{nm}$ and 
$\bar{S}_{nm}$ are not constant but slightly varying with time. Most often, the 
parametrization of the coefficients consists of two parts, 
\begin{itemize}
  \item a \emph{linear} part, including terms for a ``bias'' and a drift coefficient, pertaining 
    to a given validity interval; normally, the bias and drift are in general coherent 
    so that the result is a piece wise linear function, except in the case of earthquakes.
    E.g., for the case of \emph{CNES/GRGS RL04} (\cite{Lemoine2019}), three major 
    earthquakes have been introduced in the modelling: Sumatra on 2004/12/26, Concepcion 
    on 2010/02/27 and Sendai on 2011/03/11.
  \item a \emph{harmonic} part, usually including two annual and two semi-annual 
    coefficients for each year (in- and out-of-phase).
\end{itemize}

In these \gls{tvg} models, the normalized Stoke's coefficients are given by:
\begin{equation}\label{eq:tvg-stokes}
  \begin{aligned}
    \bar{C}_{nm} (t) = \bar{C}_{nm}\at{t_0,k} + V_{\bar{C}_{nm},k} \cdot (t-t_0) + 
      \sum_{j=0}^{N} \left( A_{\bar{C}_{nm},j} \sin \left( \frac{2\pi}{T} \delta t \right)
      + B_{\bar{C}_{nm},j} \cos \left( \frac{2\pi}{T} \delta t \right) \right) \\
    \bar{S}_{nm} (t) = \bar{S}_{nm}\at{t_0,k} + V_{\bar{S}_{nm},k} \cdot (t-t_0) + 
      \sum_{j=0}^{N} \left( A_{\bar{S}_{nm},j} \sin \left( \frac{2\pi}{T} \delta t \right)
      + B_{\bar{S}_{nm},j} \cos \left( \frac{2\pi}{T} \delta t \right) \right)
  \end{aligned}
\end{equation}
for each validity interval $k$ valid within the period $t_{start}, t_{end}$, 
where $t_{start} < t < t_{end}$ and
\begin{description}
  \item $\bar{C}_{nm}\at{t_0}$ and $\bar{S}_{nm}\at{t_0}$ are the constant, ``bias'' 
    terms for the given interval and degree/order coefficient $(n,m)$,
  \item $V_{\bar{C}_{nm}}$ and $V_{\bar{S}_{nm}}$ are the drift terms for the 
    given interval and degree/order coefficient $(n,m)$,
  \item $j$ is the number of harmonics signals (frequencies) included in the model,
  \item $A_{\bar{C}_{nm},j}$ and $A_{\bar{S}_{nm},j}$ are the in-phase amplitudes of 
    the frequency $j$, for the degree/order coefficient $(n,m)$ coefficient,
  \item $B_{\bar{C}_{nm},j}$ and $B_{\bar{S}_{nm},j}$ are the out-of-phase amplitudes of 
    the frequency $j$, for the degree/order coefficient $(n,m)$ coefficient,
  \item $t_0$ is the reference epoch for the given validity interval,
  \item $\delta t$ is the difference between the epoch $t$ and the start of the 
    current year (in years)
\end{description}

\paragraph{The \gls{icgem}}\label{par:icgem}
\gls{icgem} (\cite{icgempub}) is one of five services coordinated by the 
\gls{igfs} of the \gls{iag}. Among other services, \gls{icgem} collects and 
archives all existing global gravity field models and provides a web interface 
for getting access to them.

Gravity models are published in what is called the \emph{ICGEM-format} 
(\cite{ICGEMFormat}), an effort to standardize the distribution of such models, 
that is gaining evermore attention in recent years. This format offers great 
advantages since it is standardized, well documented, generic and can be used to 
publish and/or parse (with slight extensions) coefficients other than gravity 
models (e.g. ocean tides).

\paragraph{Implementation}\label{par:implementation}
For the purposes of the current Thesis, software has been designed and developed 
to handle the modeling of the Earth's gravity models. Highlights of the software 
are:
\begin{itemize}
  \item Handling (parsing) of gravity models published in the \emph{ICGEM-format} 
    (see \autoref{par:icgem}). This approach enables genericity, since any (recently 
    published) gravity model can be used as input to compute satellite acceleration 
    (see e.g. the listed models published in the \gls{icgem} site \url{http://icgem.gfz-potsdam.de/tom_longtime}).
    This important feature, makes the software highly suitable for scientific studies.
  \item Handling of both static and \gls{tvg} models; for the latter, the formulation 
    \autoref{eq:tvg-stokes} is used, to account for temporal modelling of the 
    Stoke's coefficients.
  \item Efficient memory handling and introduction of special data structures to 
    store and retrieve coefficients, directly targeting and exploiting their intrinsic
    characteristics (e.g. $\bar{S}_{0m}$ are not stored).
  \item Direct retrieval and usage of the data structures to compute acceleration, 
    as well as partials (i.e. $\frac{\partial \bm{\ddot{r}}}{\partial \bm{r}}$), 
    in one step.
  \item Algorithmic design to account for efficiency, yet with as close as possible 
    minimal loss of precision due to truncation errors (e.g. employ a 
    \emph{Kahan summation} algorithm, \cite{Klein2006}).
\end{itemize}

In the current Thesis, two gravity models are used, namely \emph{EIGEN-6C4} 
(\cite{Forste2014}) and \emph{CNES/GRGS RL04}. The former is mainly used for validation 
purposes (see \autoref{sssec:gravity-acceleration}). The latter is the most 
recent recommendation of the \gls{ids} (see \cite{Lemoine2019b}, \cite{Stepanek2022a}) 
used in the latest processing campaign for ITRF2020. Note though, that the software 
is designed in a generic way, allowing the introduction of any gravity field model 
structured in the \emph{ICGEM-format}.

%% -------------------------------------------------------------------- %%
\iffalse
Models for the geopotential usually describe the static part of the field. For 
precision applications, time varying effects should also be taken into account. 
According to \cite{iers2010}, these are:
\begin{itemize}
  \item secular variations of coefficients,
  \item solid Earth tides,
  \item ocean tides,
  \item solid Earth pole tide and
  \item ocean pole tide
\end{itemize}

The expression for the potential (\ref{eq:geopotential}) may easily be 
generalized to an arbitrary mass distribution by summing up the contributions 
created by individual mass elements
\(dm = \rho(\vec{s}) d^3 \vec{s}\) according to (\cite{Montenbruck2000})
\begin{equation}
    U = G \int{\frac{\rho(\vec{s}) d^3 \vec{s}}{\lvert \vec{r} - \vec{s} \rvert}}
\end{equation}

\subsection{Earth's Geopotential Models}
The geopotential field $U$ at the point $(r, \phi , \lambda )$ is expanded in 
spherical harmonics up to degree $N$, as
\begin{equation}
  \label{eq:iers201061}
  U(r, \phi , \lambda ) = \frac{G M_{\Earth}}{r} \sum_{n=0}^N 
    {\left(\frac{\alpha _e}{r}\right)}^n 
     \sum_{m=0}^n \left[ \bar{C}_{nm} \cos {m \lambda} + \bar{S}_{nm} \sin{m \lambda} \right] 
     \bar{P}_{nm}( \sin \phi )
\end{equation}
with $\bar{S}_{n0} = 0$ and $\bar{C}_{nm}$, $\bar{S}_{nm}$ the normalized
\footnote{Since the geopotential coefficients $C_{nm}$ and $S_{nm}$ span ten or 
more orders of magnitude (\cite{Montenbruck2000}), making the computation 
susceptible to overflow and round-off errors, we usually use the corresponding 
normalized values. The latter are much more uniform in magnitude, and their 
size is approximately given by the empirical \emph{Kaula rule} (see 
\cite{Montenbruck2000} and \cite{Kaula2000}):
\begin{equation} \bar{C}_{nm} , \bar{S}_{nm} \approx \frac{10^{-5}}{n^2} \end{equation}}
geopotential coefficients the normalized. $\bar{P}_{nm}$ are the normalized 
associated Legendre functions, related to the unnormalized ones by:
\begin{subequations}
  \begin{align}
    \bar{P}_{nm} &= N_{nm} P_{nm} \label{eq:iers201062a} \\
    N_{nm} &= \sqrt{\frac{(n-m)!(2n+1)(2-\delta _{0m})}{(n+m)!}} 
      \quad \delta _{0m} = 
        \begin{cases}
          1 \quad \text{ if } m = 0 \\
          0 \quad \text{ if } m \neq 0
        \end{cases}
        \label{eq:iers201062b}
  \end{align}
\end{subequations}
Correspondingly, the normalized and unnormalized geopotential coefficients are 
related by:
\begin{subequations}
  \begin{align}
    C_{nm} &= N_{nm} \bar{C}_{nm} \\
    S_{nm} &= N_{nm} \bar{S}_{nm}
  \end{align}
\end{subequations}

For all \emph{zonal} terms, we have:
\begin{equation}
  S_{n,0} = 0 \quad C_{n,0} = -J_n
\end{equation}
where we use the ``traditional'' notation $J_n$ for \emph{zonal coefficients}. 
All $S_{n0}$ coefficients vanish (due to their definition).

Coefficients for $m<n$ are known as ``\emph{tesseral}'', while when $m=n$, the 
respective coefficients are called ``\emph{sectorial}''.


\subsubsection{Static Geopotential Models}
For computations, the Earth's gravity potential at point $(r, \phi , \lambda )$
can be approximated using a spherical harmonics expansion 
(e.g. \cite{Montenbruck2000})
\begin{equation}
    U = \frac{G M_{\Earth}}{r} \sum_{n=0}^\infty \sum_{m=0}^n 
    \frac{R_{\Earth}^n}{r^n} P_{nm} \left( \sin \phi \right) 
    \left( C_{nm} \cos{m\lambda} + S_{nm} \sin{m\lambda} \right)
\end{equation}

with the coefficients \(C_{nm}\) and \(S_{nm}\) describing the dependence on the 
Earth's internal mass distribution. These coefficients can be extracted from a 
suitable geopotential model.

Note that Geopotential coefficients with \(m=0\) are called  \emph{zonal} coefficients, 
since they describe the part of the potential that does not depend on the longitude. 
All \(S_{n0}\) vanish due to their definition, and the notation \(J_n = -C_{n0}\) 
is commonly used for the remaining zonal terms. The other geopotential coefficients
are known as \emph{tesseral} and \emph{sectorial} coefficients for \(m<n\) and 
\(m = n\), respectively.

\fbox{\begin{minipage}{.9\textwidth}
To compute the acceleration \(\ddot{\vec{r}}\), which is equal to the 
gradient of \(U\), we use the recursion formulas described in \cite{Montenbruck2000}.
Note that these expressions, use the \underline{non-normalized} harmonic 
coefficients. 
\end{minipage}}

%\subsubsection{Gravity Models}
The \href{http://icgem.gfz-potsdam.de/home}{International Centre for Global Earth Models (ICGEM)}  
(\cite{icgempub}) web service hosts a large number of gravity field models, 
published in what is called the \emph{The ICGEM-format}(\cite{ICGEMFormat}). 

Such static model files can be parsed and the respective harmonic coeefficients 
(\(C_{nm}\) and \(S_{nm}\)) be used to compute satellite acceleration induced by 
the geopotential.

Practicaly, the degree and order used depends on the accuracy of the 
application and can be truncated. According to \cite{iers2010}, truncation levels 
providing a 3-dimensional orbit accuracy of better than \SI{0.5}{\mm} as a 
function of orbit radius, are listed in \ref{table:egm2008-truncation-levels} 
for EGM2008 (\cite{pavlisegm08}).

\begin{table}
\centering
\begin{tabular}{c c c}
 \hline
 Orbit radius [km] & Example Satellite & Truncation level \\
 \hline
  7331  & Starlette & 90 \\
  12270 & Lageos    & 20 \\
  26600 & GPS       & 12 \\
 \hline
\end{tabular}
\caption{Suggested truncation levels for use of EGM2008 at different orbits according to \cite{iers2010}.}
\label{table:egm2008-truncation-levels}
\end{table}
\fi
