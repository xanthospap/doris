\section{Software Tests And Orbit Determination}\label{sec:jason3-pod}

Using the software designed and implemented in the framework of this Thesis, a fundamental 
orbit determination processing pipeline was setup, to analyze \gls{jason}-3 
\gls{doris} measurements. The different, individual parts put together to achieve 
this task have already been discussed in the previous chapters, including both 
theoretical implications and implementation details. \autoref{table:processing-options} 
lists the models and parameters used for the test suite.

Tacking advantage of the modular design of the software package, made up of different 
libraries, it is trivial to implement a program targeting a \emph{pure} orbit determination 
problem using \gls{doris} observables, fitting specific user needs. 
 
\gls{jason}-3 was chosen 
to act as the test bed since it is an on-going, modern satellite mission, extensively 
documented, and its attitude determination can be performed via quaternions 
(see \autoref{ssec:jason3-attitude}). A drawback however, is its \gls{uso} susceptibility 
to \gls{saa}-induced effects (see \autoref{sec:saa}).

\begin{landscape}
\begin{table}[h!]
    %\tiny
    \centering
    \resizebox{.8\hsize}{!}{%
    \begin{tabularx}{\hsize}{p{3cm}XX}
        \toprule
        \textbf{Description} & \textbf{Model Used} & \textbf{Model Parameters} \\
        \hline
        Gravity Model & CNES/GRGS RL04 \gls{tvg} (\cite{Lemoine2019}) & up to $120^{th}$ degree and order \\
        Third Body    & Sun and Moon & Ephemeris DE421 (\cite{Folkner2009}) \\
        Solid Earth \newline Tides & IERS2010 (\cite{iers2010}) & step-1 and step-2 corrections \\
        Ocean Tide    & FES2014 (\cite{Lyard2021}) & Only major components included \\
        Atmospheric Drag & According to \autoref{sssec:atmospheric-drag}, using the NRLMSISE-00 (\cite{nrlmsise00}) model & Flux data from \href{https://celestrak.org/}{CelesTrack} (\cite{Vallado2013}) \\
        Solar Radiation \newline Pressure & According to \autoref{sssec:solar-radiation-pressure} using the macromodel provided by \cite{Cerri2022} & Occultation due to Earth modelled using the conical model (\cite{Zhang2019}) \\

        Site Positions \newline (Terrestrial RF) & DPOD2020 (\cite{Moreaux2023}) realized by the \gls{ids} Combination Center & version \texttt{dpod2020\_01}; beacon positions and meta-data extracted from SINEX \\
        Celestial/Inertial RF & \gls{gcrf} (\cite{iers2010} and \autoref{ssec:itrs-to-gcrs}) & \gls{iau} 2000/2006 resolutions, using the \gls{cio}-based transformation with full series for the polar motion (\gls{iau} 2006 precession and \gls{iau} 2000A nutation) \\
        Earth Orientation \newline Parameters & \gls{iers} 2020 C04 products (see \footnote{\url{https://datacenter.iers.org/data/2/message_471.txt}}) & interpolated as described in \autoref{ssec:eop-interpolation} \\
        Orbit Integration & Adams-Bashforth-Moulton, variable step variable order integrator (\autoref{ch:orbit-integration}) & Integration performed in \gls{tai}; equations of motions solved for including the system of variational equations (\autoref{sec:pod-variational-equations}) \\
        Filtering & Extended Kalman Filter algorithm (\autoref{sec:pod-extended-kalman-filter}), no process noise & Parameter set includes: 
        \begin{itemize}[topsep=0pt,partopsep=0pt,itemsep=1pt,parsep=1pt]
          \item[] satellite state, 
          \item[] atmospheric drag coefficient (1/\si{revolution}),
          \item[] solar radiation pressure coefficient (1/\si{revolution}),
          \item[] beacon frequency offest (per pass) as bias,
          \item[] per-beacon hydrostatic zenith path delay (per pass)
        \end{itemize} \\
        Troposphere Modelling & GPT3/VMF3 (\cite{Landskron2018}), see \autoref{ssec-tropospheric-correction} & wet zenith path delay estimated per beacon, per pass\\
       \bottomrule
    \end{tabularx}}
    \caption{Processing options used for \gls{jason}-3 orbit determination.}
    \label{table:processing-options}
\end{table}
\end{landscape}

The large number of data and product files to be processed, along with the complexity of 
the models, corresponding input parameters and user options needed to properly determine 
the analysis procedure, poses a challenging task. An efficient but on the same time 
user-friendly way of setting such input parameters must be devised. The solution adopted 
for the software package described here, is to archive such parameters in \emph{configuration files} 
using the \texttt{YAML} (\url{https://yaml.org/}) format and ``feed'' them to the 
program to drive the analysis scheme. \texttt{YAML} is a data serialization
language with the important advantage of being human-friendly. An example of such 
a file is depicted in \autoref{tab:config-example}.

\begin{adjustbox}{center, max width=\linewidth , fbox=0.5pt, captionbelow={Configuration file example.}, float=table}
\begin{BVerbatim}
---
data:
  doris-rinex: data/Jason-3/ja3rx22248.001
  sp3: data/Jason-3/ssaja320.b22238.e22258.DG_.sp3.001
reference-frame:
  station-coordinates: data/dpod2020_01.snx
eop-info:
  eop-file: data/eopc0420.1962-now
gravity:
  model: data/gfc/EIGEN-GRGS.RL04.MEAN-FIELD.gfc2
  degree: 120
  order: 120
troposphere:
  vmf3:
    grid: data/2022248.v3gr_d
force-model:
  atmospheric-drag:
    density-model: nrlmsise00
    atmo-data-csv: data/SW-All.csv
    Cd-apriori: 2e0
  srp:
    Cr-apriori: 1.5e0
...
\end{BVerbatim}
\label{tab:config-example}
\end{adjustbox}

Results of orbit determination are depicted in \autoref{fig:state}, where the state 
is given in the \texttt{dpod2020\_01} (\cite{Moreaux2023}) \gls{ecef} reference 
frame. This frame is suggested by the \gls{ids} for \gls{pod} applications.

\begin{figure}[ht]
    \centering
    \includegraphics{t5state}
    \caption{Satellite state (in \gls{ecef} RF) estimated for one day of \gls{jason}-3 orbit}
    \label{fig:state}
\end{figure}

The total number of observations per beacon are depicted in \autoref{t5obsBeacons}. 
It is worth noting that:
\begin{description}
  \item observations to beacons \texttt{ARFB} (AREQUIPA, located at Peru) and 
    \texttt{CADB} (CACHOEIRA PAULISTA, located at Brazil) were not used, 
    since the corresponding measurements were found to be largely affected by 
    \gls{saa} (see \autoref{sec:saa}), giving large residual values
  \item observations to beacon \texttt{HOFC} (HOFN, installed in Iceland) were not used; this site was installed in 
    September 2020, and no available data based on operational Numerical Weather Model (NWM) 
    were found at the VMF Data Server (\cite{vmf3DataServer})
\end{description}
\begin{figure}[ht]
    \centering
    \includegraphics[scale=1.0]{t5obsBeacons}
    \caption{Number of measurements performed by the on-board \gls{jason}-3 \gls{doris} receiver per ground beacon.}
    \label{fig:obsPerBeacon}
\end{figure}

\autoref{fig:accelerations} depicts the computed acceleration components for the 
force model considered. Atmospheric drag forces are below the order of \SI{1e-18}{\meter\per\second\squared} 
and are not included, as they are well beyond the targeted precision. For the altitude 
of \gls{jason}-3, solar radiation pressure is several orders of magnitude larger than 
atmospheric drag, a fact usually inverted for \gls{leo} satellites if lower 
altitude. Identification of dominant accelerations and thereby forces, is crucial 
for further enhancements of the software since it enables prioritization of further 
development.

\begin{figure}[ht]
    \centering
    \includegraphics{t8ndaccelerations}
    \caption{Computed accelerations for one day of \gls{jason}-3 orbit; $y-$axis in logarithmic scale.}
    \label{fig:accelerations}
\end{figure}

To validate and check the results obtained for the satellite state estimates, 
\gls{jason}-3 sp3 files were retrieved from \gls{cddis} (\cite{Noll2010}), recording 
state (in cartesian components) for the day of interest, with a sampling rate of 
\SI{1}{\second}. These solutions are computed by \gls{cnes}'s new-generation ground segment 
called SSALTO\footnote{https://www.aviso.altimetry.fr/en/newsletter07/ssalto-a-new-ground-segment-for-a-new-generation-of-altimetry-satellites.html} 
and are produced using \gls{doris} and \gls{gps} observations. Documentation 
for the data analysis procedure and the models used therein, is available at 
\url{ftp://ftp.ids-doris.org/pub/ids/data/POD_configuration_POEF.pdf}. Note that 
according to the \gls{pod} specifications used by SSALTO, a large number of models 
and options are different from the ones used in the test-suite program listed in 
\autoref{table:processing-options}. These sp3 files record satellite state of the 
spacecraft's center of gravity, in \gls{itrf}.

Despite the fact that inclusion of \gls{gps} data may introduce inconsistencies 
when compared to a \gls{doris}-only solution, the high sampling rate of these 
product files makes extrapolation of reference trajectories trivial and only introduces 
small errors (see \autoref{sec:integrator-validation}). The procedure for computing 
reference solutions (state estimates) included the following steps:
\begin{enumerate}
  \item \label{en:st1} get (next) epoch $t$ for which the test-suite has produced a state estimate
  \item find the record in the reference sp3 file closest to $t$, $t_0$
  \item extrapolate the state from $t_0$ to $t$; go to \autoref{en:st1} and repeat 
    until a reference state is computed for all $t$
\end{enumerate}

Results of the comparison are depicted in \autoref{fig:statediffs} using an \gls{ecef} 
reference frame, and in \autoref{fig:statediffseci} using the celestial \gls{gcrf} 
frame. For the latter case, the retrieved sp3 state records were first transformed to 
the \gls{gcrf} frame, and then compared to the estimated state.

\begin{figure}[ht]
    \centering
    \includegraphics{t5statediffs}
    \caption{Discrepancies of estimated state against the orbits estimated at \gls{cnes}/AALTO for one day of \gls{jason}-3 orbit (in \gls{ecef} RF).}
    \label{fig:statediffs}
\end{figure}

A description of the differences in the \gls{ecef} frame is recorded in 
\autoref{table:statediffs}. For the position estimates, it is evident that the $x$ 
and $y$ components are in better 
agreement with the reference results, with max discrepancies in the order of 
\SI{2}{\metre} (in absolute value). For the $z$ component, max difference reaches 
a value of \SI{3.5}{\metre} (in absolute value). All three component differences 
seem to be dominated by periodic signal(s), while for the $z$ component case, 
a trend is also evident, correlating the ``worsening'' of results with time.

\begin{table}[h!]
    \centering
    \begin{tabularx}{\textwidth}{cccccc}
        \toprule
        \textbf{Component} & \textbf{Mean} & \textbf{Std. deviation} & \textbf{Max Value} & \textbf{Min Value} & \textbf{Units}\\
        \hline
        $x$   &  +0.17 & $\pm$ 0.64 & 2.09 & -1.59 & \si{\metre}\\
        $y$   &  +0.00 & $\pm$ 0.57 & 1.33 & -2.01 & \si{\metre}\\
        $z$   &  +0.86 & $\pm$ 0.72 & 3.52 & -0.17 & \si{\metre}\\
        $v_x$ &  -0.03 & $\pm$ 0.58 & 2.19 & -1.48 & \si{\milli\metre\per\second}\\
        $v_y$ &  +0.01 & $\pm$ 0.44 & 1.11 & -1.09 & \si{\milli\metre\per\second}\\
        $v_z$ &  +0.03 & $\pm$ 0.65 & 2.29 & -2.22 & \si{\milli\metre\per\second}\\
       \bottomrule
    \end{tabularx}
    \caption{Details of discrepancies between estimated state against the orbits estimated at \gls{cnes}/AALTO for one day of \gls{jason}-3 orbit, depicted in \autoref{fig:statediffs}.}
    \label{table:statediffs}
\end{table}

Velocity differences range between \numrange{-2.2}{2.3} \si{\milli\metre\per\sec} and, as is the 
case for position estimates, are worse in the $z$ component direction (see 
\autoref{table:statediffs}).

Transforming the state estimates and respective reference results to the \gls{gcrf} 
reference frame, absolute values of differences remain the same, though a trend in 
the $y$ and $z$ directions is more evident, with values of \SI{-0.91}{\metre\per\day} 
and \SI{+1.66}{\metre\per\day} respectively. A degradation of velocity estimates with 
time is also clear in this case (see \autoref{fig:statediffseci}).

\begin{figure}[ht]
    \centering
    \includegraphics{t9stateDiffsEci}
    \caption{Discrepancies of estimated state against the orbits estimated at \gls{cnes}/AALTO for one day of \gls{jason}-3 orbit (in \gls{gcrf}).}
    \label{fig:statediffseci}
\end{figure}

Since both the \gls{gcrf} and \gls{ecef} state differences seem to include 
harmonic signals, an analysis of the underlying dominant frequencies was performed to 
identify the spectral densities of the signal. For this purpose, the 
\emph{Lombâ€“Scargle periodogram} (\cite{Scargle1982}) was used; this method enables 
the efficient computation of periodograms for unevenly spaced samples. Since the 
state differences cover a time span of one day with a sampling rate of $\approx \SI{1}{\sec}$, 
the spectral range was chosen to span the periods \numrange{0.1}{6} \si{\hour}, 
avoiding aliasing effects (see e.g. \cite{VanderPlas2018}). Results are depicted in 
\autoref{fig:lsperiodecef} for differences computed in the \gls{ecef} reference frame 
and \autoref{fig:lsperiodeci} for the \gls{gcrf} reference frame respectively.

\begin{figure}[ht]
    \centering
    \includegraphics{t9periodogramEcef}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for satellite state in \gls{ecef}.}
    \label{fig:lsperiodecef}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics{t9periodogramEci}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for satellite state in \gls{gcrf}.}
    \label{fig:lsperiodeci}
\end{figure}

The estimated periodograms show a clear prevalence of two harmonics with periods of 
$\approx \SI{1}{\hour}$ and $\approx \SI{2}{\hour}$. Position estimates are dominated by 
the second frequency, while velocity estimates by the first. Note that \gls{jason}-3 
completes a revolution around the Earth in \SI{112.4}{\minute} or $\approx \SI{1.9}{\hour}$. 
This frequency coincides with the findings of the periodogram for the case of position 
estimates.

To gain a clearer view on the satellite position differences, discrepancies are often 
transformed to an ``orbital frame'', defined by the radial and velocity vectors. 
The $x-$axis of this frame is the \emph{radial} axis, directed from the unit vector of 
satellite position. The $y-$axis, labelled \emph{in-track} axis, is in the direction 
of motion, while the $z-$axis called \emph{cross-track} is directed from the unit 
vector of normal orbit (\cite{Eunhyouek2019}). Position differences between estimates and 
reference results are depicted in \autoref{fig:statediffsrtn}, transformed to the radial, 
across-track and in-track frame. The in-track component is very smooth, and in good 
agreement with the reference solution; the maximum difference in this case is 
$\approx \SI{0.17}{\meter}$. The radial component is dominated by a periodic harmonic of 
$\approx \SI{2}{\hour}$, with a growing amplitude. Max discrepancies in this case are 
$\approx \SI{1.5}{\meter}$, at the end of the day. The cross-track component presents the 
largest fluctuations, and apart from the identified harmonic of $\approx \SI{2}{\hour}$ 
seems to follow a parabolic pattern. Details are given in \autoref{table:statediffsrtn}.
\begin{figure}[ht]
    \centering
    \includegraphics[scale=.9]{t9stateDiffsRtn}
    \caption{Discrepancies of estimated state against the orbits estimated at \gls{cnes}/AALTO for one day of \gls{jason}-3 orbit (in radial, across-track and in-track RF).}
    \label{fig:statediffsrtn}
\end{figure}

\begin{table}[h!]
    \centering
    \begin{tabularx}{\textwidth}{cccccc}
        \toprule
        \textbf{Component} & \textbf{Mean} & \textbf{Std. deviation} & \textbf{Max Value} & \textbf{Min Value} & \textbf{Units}\\
        \hline
        radial &  -0.03 & $\pm$ 0.57 & 1.26 & -1.46 & \si{\metre}\\
        in track &  +0.00 & $\pm$ 0.06 & 0.17 & -0.15 & \si{\metre}\\
        cross track &  -0.19 & $\pm$ 1.29 & 3.99 & -2.11 & \si{\metre}\\
       \bottomrule
    \end{tabularx}
    \caption{Details of discrepancies between estimated state against the orbits estimated at \gls{cnes}/AALTO for one day of \gls{jason}-3 orbit, depicted in \autoref{fig:statediffsrtn}.}
    \label{table:statediffsrtn}
\end{table}

% tODO comment on this
\begin{figure}[ht]
    \centering
    \includegraphics{t5dstatediffs}
    \caption{Discrepancies of estimated state against the orbits estimated at \gls{cnes}/AALTO for one day of \gls{jason}-3 orbit (in \gls{ecef} RF). Red colored regions depict passing through shadow, while green lines mark orbital revolutions.}
    \label{fig:statediffs-details}
\end{figure}

\autoref{fig:ResVsTimeRaw} depicts the residuals of the analysis, i.e. the \emph{Observed} 
- \emph{Computed} values. Residuals are higher at the beginning of the analysis interval, but 
quickly converge to smaller values. This effect is due to the unknown a-priori values mainly of 
the beacon relative frequency offsets (see \autoref{ssec:doris-computational-aspects}). 
\begin{figure}[ht]
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{t4-resVsTimeRaw}
    \caption{\gls{doris} residuals computed from one day of \gls{jason}-3 orbit determination.}
    \label{fig:ResVsTimeRaw}
\end{figure}

A more enlightening view of the residuals can be obtained in \autoref{fig:ResVsTime} and 
\autoref{fig:ResVsEle}, where the large starting values are filtered out. The first 
plot depicts the computed residuals with respect to time, while the latter with respect to 
elevation angle. 
\begin{figure}[ht]
    \centering
    \includegraphics{t5resVsTime}
    \caption{\gls{doris} residuals computed from one day of \gls{jason}-3 orbit determination.}
    \label{fig:ResVsTime}
\end{figure}

From \autoref{fig:ResVsEle} it can be seen that observations at elevation angles that 
approach the cut-off angle of \ang{10}, have larger residual values, a fact to be expected. 
There also seems to be a systematic offset of $\approx \SI{8}{\milli\meter\per\second}$ 
between the computed and the observed values. To check whether this offset has to do 
with a specific (ground) antenna type, residual values with respect to antenna type 
are depicted in \autoref{fig:ResVsEleVsAntenna}. For the epoch under study, \gls{doris} 
beacons were equipped with two different antennae, namely STAREC-B and STAREC-C, which 
share geometric characteristics (see \autoref{sec:doris-ground-segment}). No evident 
dependence of residual values on antenna type though could be found. Hence, the 
systematic offset can be attributed to either
\begin{itemize}
  \item mismodeling of the geometric characteristics of ground antennae (e.g. antenna reference point(s), \gls{pco})
  \item mismodeling or non-mitigated errors in the observation equation model
\end{itemize}
\begin{figure}[ht]
    \centering
    \includegraphics{t5resVsEle}
    \caption{\gls{doris} residuals w.r.t. elevation angle computed from one day of \gls{jason}-3 orbit determination.}
    \label{fig:ResVsEle}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics{t5resVsEleVsAntenna}
    \caption{\gls{doris} residuals w.r.t. elevation angle computed from one day of \gls{jason}-3 orbit determination.}
    \label{fig:ResVsEleVsAntenna}
\end{figure}

Apart from satellite state and beacon-specific parameters, the orbit determination process 
involves estimation of a number of \emph{dynamic} orbit parameters. For the setup used here, 
these are the solar radiation pressure coefficient, $C_r$ and the atmospheric drag 
coefficient $C_d$. Estimated values for these parameters are depicted in 
\autoref{fig:EstimDynamicParams}. While solar radiation pressure coefficient, $C_r$ 
is stable throughout the time interval analyzed, the atmospheric drag coefficient 
shows larger discrepancies. This can be attributed to
\begin{itemize}
  \item an erroneous a-priori value, and
  \item an ``absorption'' of mismodeled or remaining errors of the analysis
\end{itemize}
Since the $C_r$ term is estimated once per revolution, while $C_d$ is estimated for the 
whole time interval, it is easier for the first to ``absorb'' remaining errors.
\begin{figure}[ht]
    \centering
    \includegraphics{t5dynamicParams}
    \caption{Estimated dynamic orbit parameters (drag and solar radiation pressure coefficients, $C_d$ and $C_r$), for one day of \gls{jason}-3 orbit determination.}
    \label{fig:EstimDynamicParams}
\end{figure}

\iffalse
\begin{figure}
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{p00-lombscargle}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for component $x$.}
    \label{fig:lsperiodx}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{p10-lombscargle}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for component $y$.}
    \label{fig:lsperiody}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{p20-lombscargle}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for component $z$.}
    \label{fig:lsperiodz}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{p01-lombscargle}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for component $v_x$.}
    \label{fig:lsperiodvx}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{p11-lombscargle}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for component $v_y$.}
    \label{fig:lsperiodvy}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[height=.5\textheight,keepaspectratio]{p21-lombscargle}
    \caption{Lomb-Scargle periodogram for the differences between estimated and reference results for component $v_z$.}
    \label{fig:lsperiodvz}
\end{figure}
\fi
